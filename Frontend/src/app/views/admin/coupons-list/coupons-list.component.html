<div class="container mt-4">
  <div class="pb-2">
    <button class="btn btn-class float-end" [routerLink]="['add']">
      Add Coupon
    </button>
  </div>
  <div class="nav nav-tabs">
    <div class="nav-item">
      <button
        [ngClass]="isOwn ? 'nav-link active text-black' : 'nav-link text-black'"
        (click)="toggleState(true)"
        [disabled]="isOwn"
      >
        Own
      </button>
    </div>
    <div class="nav-item">
      <button
        [ngClass]="
          !isOwn ? 'nav-link active text-black' : 'nav-link text-black'
        "
        (click)="toggleState(false)"
        [disabled]="!isOwn"
      >
        Others
      </button>
    </div>
  </div>

  <ng-template #content let-modal>
    <table class="table table-striped text-center">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Username</th>
          <th scope="col">Email</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of selectedList; index as i">
          <th scope="row">
            {{ i + 1 }}
          </th>
          <td>{{ data.username }}</td>
          <td>{{ data.email }}</td>
        </tr>
      </tbody>
    </table>
  </ng-template>

  <table
    class="table table-striped text-center"
    *ngIf="coupons?.totalDocs || 0 > 0; else noData"
  >
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Coupon Code</th>
        <th scope="col">Coupon Name</th>
        <th scope="col">Type</th>
        <th scope="col">Discount (%)</th>
        <th scope="col">Activated On</th>
        <th scope="col">Expiry Date</th>
        <th scope="col">Utilization</th>
        <th scope="col" *ngIf="!isOwn">Created By</th>
        <th scope="col" *ngIf="isOwn">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of tableData; index as i">
        <th scope="row">
          {{ ((coupons?.page || 1) - 1) * (coupons?.limit || 10) + i + 1 }}
        </th>
        <td>{{ data.couponCode }}</td>
        <td>{{ data.name }}</td>
        <td>{{ data.type }}</td>
        <td>
          {{ data.discountPercent }}
        </td>
        <td>
          <div>{{ data.activationDate | date : "mediumDate" }}</div>
          <div>{{ data.activationDate | date : "h:mm a" }}</div>
        </td>

        <td>
          <div>{{ data.expiryDate | date : "mediumDate" }}</div>
          <div>{{ data.expiryDate | date : "h:mm a" }}</div>
        </td>

        <td (click)="open(content, data.usedBy)" style="cursor: pointer">
          {{ data.usedBy.length }}
        </td>
        <td *ngIf="!isOwn">
          {{ data.createdBy.username }}
        </td>
        <td *ngIf="isOwn">
          <button
            type="button"
            [ngClass]="
              data.isEnabled
                ? 'btn btn-sm btn-outline-danger'
                : 'btn btn-sm btn-outline-success'
            "
            (click)="toggleCouponStatus(data._id, !data.isEnabled)"
          >
            {{ data.isEnabled ? "Disable" : "Enable" }}
          </button>
          <button class="custom-button mx-3" [routerLink]="['edit', data._id]">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-pencil-square"
              viewBox="0 0 16 16"
            >
              <path
                d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"
              />
              <path
                fill-rule="evenodd"
                d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"
              />
            </svg>
          </button>

          <button class="custom-button mx-3" (click)="deleteCoupon(data._id)">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-trash"
              viewBox="0 0 16 16"
            >
              <path
                d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"
              />
              <path
                d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"
              />
            </svg>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <ng-template #noData>
    <div class="text-center mt-5">
      <h3>No Coupons to Display !!</h3>
    </div>
  </ng-template>

  <app-pagination
    [totalItems]="coupons?.totalDocs || 0"
    [page]="coupons?.page || 1"
    (pageChange)="pageChange($event)"
  ></app-pagination>
</div>
